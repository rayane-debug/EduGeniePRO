<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduGenie Pro - Système Éducatif IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Bibliothèque pour générer des fichiers PowerPoint -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            overflow: hidden;
        }
        .sidebar { width: 25%; }
        .main-content { width: 75%; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:hover {
            transform: translateY(-5px);
            background: white;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.05);
        }
        
        .modal-backdrop {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal-active { display: flex; }

        .lesson-content h2 { color: #2563eb; font-weight: 800; font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.75rem; border-left: 4px solid #2563eb; padding-left: 1rem; }
        .lesson-content p { margin-bottom: 1rem; line-height: 1.7; color: #334155; }
        .lesson-content ul { margin-bottom: 1.5rem; }
        .lesson-content li { position: relative; padding-left: 1.5rem; margin-bottom: 0.5rem; list-style: none; }
        .lesson-content li::before { content: "→"; position: absolute; left: 0; color: #2563eb; font-weight: bold; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        @media print {
            .no-print { display: none !important; }
            .print-area { display: block !important; width: 100% !important; margin: 0 !important; }
            body { overflow: visible !important; height: auto !important; }
        }

        .rtl { direction: rtl; }
        
        .flip-card { background-color: transparent; perspective: 1000px; height: 220px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 2rem; display: flex; align-items: center; justify-content: center; padding: 2rem; font-weight: 600; font-size: 1.1rem; }
        .flip-card-back { transform: rotateY(180deg); }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-slate-900">

    <!-- BARRE LATÉRALE -->
    <aside class="sidebar bg-white p-8 flex flex-col no-print border-r border-slate-200 h-full overflow-y-auto">
        <div class="flex items-center gap-3 mb-12 px-2">
            <div class="bg-indigo-600 p-2.5 rounded-2xl shadow-xl shadow-indigo-200">
                <i data-lucide="sparkles" class="w-6 h-6 text-white"></i>
            </div>
            <span class="text-2xl font-extrabold tracking-tight">EduGenie<span class="text-indigo-600">.</span></span>
        </div>

        <div class="space-y-4">
            <button onclick="openModal('tuteur')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-blue-50 text-blue-600 rounded-2xl group-hover:bg-blue-600 group-hover:text-white transition-all">
                    <i data-lucide="book-open"></i>
                </div>
                <div>
                    <h3 class="font-bold">L'Explicateur</h3>
                    <p class="text-xs text-slate-500">Analyse visuelle</p>
                </div>
            </button>

            <button onclick="openModal('quiz')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-emerald-50 text-emerald-600 rounded-2xl group-hover:bg-emerald-600 group-hover:text-white transition-all">
                    <i data-lucide="brain-circuit"></i>
                </div>
                <div>
                    <h3 class="font-bold">Quiz Interactif</h3>
                    <p class="text-xs text-slate-500">Avec score final</p>
                </div>
            </button>

            <button onclick="openModal('exam')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-rose-50 text-rose-600 rounded-2xl group-hover:bg-rose-600 group-hover:text-white transition-all">
                    <i data-lucide="printer"></i>
                </div>
                <div>
                    <h3 class="font-bold">Examen Papier</h3>
                    <p class="text-xs text-slate-500">Prêt à imprimer</p>
                </div>
            </button>

            <button onclick="openModal('flash')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-amber-50 text-amber-600 rounded-2xl group-hover:bg-amber-600 group-hover:text-white transition-all">
                    <i data-lucide="layers"></i>
                </div>
                <div>
                    <h3 class="font-bold">Flashcards</h3>
                    <p class="text-xs text-slate-500">Mémorisation fun</p>
                </div>
            </button>

            <button onclick="openModal('ppt')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-orange-50 text-orange-600 rounded-2xl group-hover:bg-orange-600 group-hover:text-white transition-all">
                    <i data-lucide="presentation"></i>
                </div>
                <div>
                    <h3 class="font-bold">Générateur Slides</h3>
                    <p class="text-xs text-slate-500">Export Google Slides</p>
                </div>
            </button>

            <button onclick="openModal('word')" class="glass-card w-full p-5 rounded-3xl flex items-center gap-4 text-left group">
                <div class="p-3 bg-sky-50 text-sky-600 rounded-2xl group-hover:bg-sky-600 group-hover:text-white transition-all">
                    <i data-lucide="file-text"></i>
                </div>
                <div>
                    <h3 class="font-bold">Document Word</h3>
                    <p class="text-xs text-slate-500">Rédaction assistée</p>
                </div>
            </button>
        </div>

        <div class="mt-auto p-5 bg-slate-50 rounded-[2rem] border border-slate-100">
            <p class="text-[10px] text-slate-400 font-bold mb-2 uppercase tracking-widest">Technologie</p>
            <div class="flex justify-between items-center text-xs font-bold text-indigo-600">
                <span>Gemini 2.5 Flash</span>
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></div>
            </div>
        </div>
    </aside>

    <!-- ZONE D'AFFICHAGE PRINCIPALE -->
    <main class="main-content h-full overflow-y-auto p-12 relative bg-slate-50/50">
        <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-8">
            <div class="w-32 h-32 bg-white rounded-[3rem] shadow-xl flex items-center justify-center animate-bounce">
                <i data-lucide="sparkle" class="w-12 h-12 text-indigo-600"></i>
            </div>
            <div>
                <h1 class="text-5xl font-black text-slate-900 mb-4 tracking-tight">Bonjour !</h1>
                <p class="text-slate-500 max-w-sm mx-auto text-lg">Sélectionnez un outil pour transformer votre façon d'apprendre avec l'IA.</p>
            </div>
        </div>

        <div id="result-display" class="hidden w-full max-w-4xl mx-auto space-y-10 pb-24"></div>
    </main>

    <!-- MODALE -->
    <div id="modal-container" class="modal-backdrop no-print">
        <div class="bg-white w-full max-w-lg rounded-[3.5rem] shadow-2xl p-12 relative animate-in slide-in-from-bottom-10 duration-500">
            <button onclick="closeModal()" class="absolute top-8 right-8 w-10 h-10 flex items-center justify-center bg-slate-50 rounded-full text-slate-400 hover:text-slate-900 transition-colors">
                <i data-lucide="x"></i>
            </button>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const modalContainer = document.getElementById('modal-container');
        const modalContent = document.getElementById('modal-content');
        const welcomeScreen = document.getElementById('welcome-screen');
        const resultDisplay = document.getElementById('result-display');

        const apiKey = ""; 
        let currentQuizData = null;
        let userAnswers = [];
        let currentWordContent = ""; // Stockage global pour éviter les erreurs d'échappement

        const cleanFormatPrompt = "CONSIGNE DE STYLE : Écris comme un auteur de manuel scolaire moderne. Utilise des lettres, chiffres, accents et ponctuation courante. N'utilise JAMAIS de symboles Markdown (étoiles, hashtags). Pour structurer, commence tes titres de sections par 'TITRE:' et tes points importants par 'POINT:'. Ne mets pas de gras ou d'italique.";

        async function callGemini(prompt, isJson = false) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const fullPrompt = isJson ? prompt : `${cleanFormatPrompt}\n\n${prompt}`;
            const payload = {
                contents: [{ parts: [{ text: fullPrompt }] }],
                generationConfig: isJson ? { responseMimeType: "application/json" } : {}
            };

            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`Erreur API: ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (e) {
                    if (i === 4) throw e;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
        }

        function formatLessonHTML(text) {
            let lines = text.split('\n');
            let html = '<div class="lesson-content">';
            let inList = false;
            lines.forEach(line => {
                let cleanLine = line.trim();
                if (!cleanLine) return;
                if (cleanLine.startsWith('TITRE:')) {
                    if (inList) { html += '</ul>'; inList = false; }
                    html += `<h2>${cleanLine.replace('TITRE:', '').trim()}</h2>`;
                } else if (cleanLine.startsWith('POINT:')) {
                    if (!inList) { html += '<ul class="space-y-2">'; inList = true; }
                    html += `<li>${cleanLine.replace('POINT:', '').trim()}</li>`;
                } else {
                    if (inList) { html += '</ul>'; inList = false; }
                    html += `<p>${cleanLine}</p>`;
                }
            });
            if (inList) html += '</ul>';
            html += '</div>';
            return html;
        }

        function openModal(type) {
            modalContainer.classList.add('modal-active');
            let html = '';
            switch(type) {
                case 'tuteur':
                    html = `<h2 class="text-3xl font-black mb-4 text-blue-600">Explicateur</h2><textarea id="inp-lesson" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] h-48 outline-none mb-4" placeholder="Votre texte ici..."></textarea><button onclick="processTuteur()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-bold">Transformer ✨</button>`;
                    break;
                case 'quiz':
                    html = `<h2 class="text-3xl font-black mb-4 text-emerald-600">Quiz IA</h2><textarea id="inp-quiz-text" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] h-32 outline-none mb-4" placeholder="Texte source..."></textarea><button onclick="processQuiz()" class="w-full bg-emerald-600 text-white py-5 rounded-[2rem] font-bold">Lancer ✨</button>`;
                    break;
                case 'flash':
                    html = `<h2 class="text-3xl font-black mb-4 text-amber-600">Flashcards</h2><textarea id="inp-flash-text" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] h-32 outline-none mb-4" placeholder="Sujet..."></textarea><button onclick="processFlash()" class="w-full bg-amber-500 text-white py-5 rounded-[2rem] font-bold">Générer ✨</button>`;
                    break;
                case 'exam':
                    html = `<h2 class="text-3xl font-black mb-4 text-rose-600">Examen</h2><input id="inp-exam-subject" type="text" placeholder="Matière" class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-[1.5rem] mb-4"><button onclick="processExam()" class="w-full bg-slate-900 text-white py-5 rounded-[2rem] font-bold">Créer ✨</button>`;
                    break;
                case 'ppt':
                    html = `<h2 class="text-3xl font-black mb-4 text-orange-600">Slides</h2><input id="inp-ppt-topic" type="text" placeholder="Sujet de la présentation" class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-[1.5rem] mb-4"><button onclick="processPPT()" class="w-full bg-orange-600 text-white py-5 rounded-[2rem] font-bold">Générer le projet ✨</button>`;
                    break;
                case 'word':
                    html = `<h2 class="text-3xl font-black mb-4 text-sky-600">Word</h2><textarea id="inp-word-prompt" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-[2rem] h-32 outline-none mb-4" placeholder="Sujet du document..."></textarea><button onclick="processWord()" class="w-full bg-sky-600 text-white py-5 rounded-[2rem] font-bold">Rédiger ✨</button>`;
                    break;
            }
            modalContent.innerHTML = html;
            lucide.createIcons();
        }

        function closeModal() { modalContainer.classList.remove('modal-active'); }

        function showLoading() {
            welcomeScreen.classList.add('hidden');
            resultDisplay.classList.remove('hidden');
            resultDisplay.innerHTML = `<div class="flex flex-col items-center justify-center p-20 animate-pulse text-center"><div class="w-20 h-20 border-8 border-indigo-600 border-t-transparent rounded-full animate-spin mb-8"></div><p class="font-extrabold text-2xl text-slate-800">Intelligence Artificielle au travail...</p></div>`;
        }

        async function processPPT() {
            const topic = document.getElementById('inp-ppt-topic').value;
            if(!topic) return; closeModal(); showLoading();
            try {
                const res = await callGemini(`Génère un plan de présentation structuré en JSON pour le sujet : "${topic}". Format : { "slides": [ { "title": "...", "content": ["point 1", "point 2", "..."] } ] }. Max 8 slides. Pas de Markdown.`, true);
                const data = JSON.parse(res);
                
                let previewHtml = data.slides.map((s, i) => `
                    <div class="bg-white p-8 rounded-[2rem] border-2 border-orange-50 shadow-sm relative overflow-hidden">
                        <span class="absolute top-4 right-6 text-orange-200 font-black text-4xl">#${i+1}</span>
                        <h3 class="text-xl font-bold text-slate-800 mb-4">${s.title}</h3>
                        <ul class="space-y-2 text-slate-500 text-sm">
                            ${s.content.map(p => `<li>• ${p}</li>`).join('')}
                        </ul>
                    </div>`).join('');

                resultDisplay.innerHTML = `
                    <div class="bg-white p-12 rounded-[4rem] shadow-2xl animate-in slide-in-from-bottom-5 duration-700">
                        <div class="flex justify-between items-center mb-10">
                            <h2 class="text-3xl font-black text-orange-600">Projet Slide : ${topic}</h2>
                            <button id="btn-export-slides" class="bg-orange-600 text-white px-8 py-4 rounded-[1.5rem] font-bold flex items-center gap-3 hover:scale-105 transition-all shadow-lg shadow-orange-100">
                                <i data-lucide="external-link"></i> Exporter vers Google Slides
                            </button>
                        </div>
                        <div class="grid md:grid-cols-2 gap-6">${previewHtml}</div>
                        <div class="mt-8 p-6 bg-blue-50 rounded-[2rem] flex items-center gap-4 text-blue-700 text-sm font-medium">
                            <i data-lucide="info" class="w-8 h-8"></i>
                            <p>Une fois le fichier téléchargé, ouvrez <b>Google Slides</b> et importez-le (Fichier > Ouvrir > Importer). Le projet sera prêt à être présenté !</p>
                        </div>
                    </div>`;
                
                document.getElementById('btn-export-slides').onclick = () => exportToPPTX(data);
                lucide.createIcons();
            } catch(e) { 
                console.error(e);
                resultDisplay.innerHTML = `<p class="text-red-500">Erreur lors de la génération. Réessayez.</p>`;
            }
        }

        function exportToPPTX(data) {
            let pptx = new PptxGenJS();
            data.slides.forEach(slideData => {
                let slide = pptx.addSlide();
                slide.addText(slideData.title, { x: 0.5, y: 0.5, w: '90%', h: 1, fontSize: 32, bold: true, color: '363636', fontFace: 'Arial' });
                slide.addText(slideData.content.map(p => { return { text: p, options: { bullet: true, indentLevel: 0 } }; }), { x: 0.5, y: 1.5, w: '90%', h: 4, fontSize: 18, color: '666666', valign: 'top' });
                slide.addShape(pptx.ShapeType.rect, { x:0, y:5.4, w:'100%', h:0.2, fill: {color:'FF8C00'} });
            });
            pptx.writeFile({ fileName: `EduGenie_Presentation.pptx` }).then(() => {
                window.open("https://slides.google.com", "_blank");
            });
        }

        async function processTuteur() {
            const text = document.getElementById('inp-lesson').value;
            if(!text) return; closeModal(); showLoading();
            const res = await callGemini(`Explique ce contenu avec TITRE: et POINT:. ${text}`);
            resultDisplay.innerHTML = `<div class="bg-white p-12 rounded-[4rem] shadow-xl border border-slate-100 animate-in fade-in duration-700"><h2 class="text-4xl font-black mb-8">Analyse Terminée</h2>${formatLessonHTML(res)}</div>`;
            lucide.createIcons();
        }

        async function processQuiz() {
            const text = document.getElementById('inp-quiz-text').value;
            if(!text) return; closeModal(); showLoading();
            const res = await callGemini(`Quiz JSON 5 questions : { "title": "titre", "questions": [ { "q": "question", "options": ["A", "B", "C", "D"], "correct": 0 } ] }. Texte : ${text}`, true);
            currentQuizData = JSON.parse(res);
            userAnswers = new Array(currentQuizData.questions.length).fill(null);
            renderQuiz();
        }

        function renderQuiz() {
            let qHtml = currentQuizData.questions.map((q, i) => `
                <div class="p-8 bg-slate-50 rounded-[2rem] border border-slate-100">
                    <p class="font-bold mb-4 text-lg">${i+1}. ${q.q}</p>
                    <div class="grid gap-2" id="q-block-${i}">
                        ${q.options.map((opt, oi) => `<button onclick="handleQuizAnswer(${i}, ${oi})" class="p-4 bg-white border rounded-[1rem] hover:bg-indigo-50 text-left font-medium transition-all">${opt}</button>`).join('')}
                    </div>
                </div>`).join('');
            resultDisplay.innerHTML = `<div class="bg-white p-12 rounded-[4rem] shadow-2xl">
                <h2 class="text-3xl font-black text-emerald-600 mb-8">${currentQuizData.title}</h2>
                <div class="space-y-6">${qHtml}</div>
            </div>`;
        }

        function handleQuizAnswer(qI, oI) {
            if (userAnswers[qI] !== null) return;
            userAnswers[qI] = oI;
            const block = document.getElementById(`q-block-${qI}`);
            const buttons = block.querySelectorAll('button');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === currentQuizData.questions[qI].correct) btn.classList.add('bg-emerald-500', 'text-white');
                else if (i === oI) btn.classList.add('bg-rose-500', 'text-white');
            });
        }

        async function processFlash() {
            const text = document.getElementById('inp-flash-text').value;
            if(!text) return; closeModal(); showLoading();
            const res = await callGemini(`6 flashcards JSON: { "cards": [ {"q": "Q", "a": "R"} ] }. Texte : ${text}`, true);
            const data = JSON.parse(res);
            let html = data.cards.map(c => `
                <div class="flip-card cursor-pointer" onclick="this.classList.toggle('flipped')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front bg-indigo-600 text-white rounded-[2rem]">${c.q}</div>
                        <div class="flip-card-back bg-white border-4 border-indigo-100 text-indigo-900 rounded-[2rem] shadow-xl">${c.a}</div>
                    </div>
                </div>`).join('');
            resultDisplay.innerHTML = `<div class="grid md:grid-cols-2 gap-8">${html}</div>`;
        }

        async function processWord() {
            const promptInput = document.getElementById('inp-word-prompt').value;
            if(!promptInput) return; closeModal(); showLoading();
            try {
                const res = await callGemini(`Document complet pour : ${promptInput}. Pas de Markdown.`);
                currentWordContent = res;
                resultDisplay.innerHTML = `
                    <div class="bg-white p-12 rounded-[4rem] shadow-xl">
                        <h2 class="text-3xl font-black mb-8 text-sky-600">Document Rédigé</h2>
                        <div class="whitespace-pre-wrap text-slate-700 bg-slate-50 p-8 rounded-[2rem] border border-slate-100 mb-8">${res}</div>
                        <button id="btn-export-word" class="w-full bg-sky-600 text-white py-6 rounded-[2rem] font-black flex items-center justify-center gap-3">
                            <i data-lucide="download"></i> Télécharger en .doc
                        </button>
                    </div>`;
                
                document.getElementById('btn-export-word').onclick = () => exportDoc(currentWordContent);
                lucide.createIcons();
            } catch (e) {
                console.error(e);
                resultDisplay.innerHTML = `<p class="text-red-500">Erreur lors de la rédaction.</p>`;
            }
        }

        function exportDoc(c) {
            const blob = new Blob(['\ufeff', c], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'EduGenie_Document.doc'; a.click();
        }

        async function processExam() {
            const subj = document.getElementById('inp-exam-subject').value;
            closeModal(); showLoading();
            const res = await callGemini(`Sujet examen complet pour : ${subj}.`);
            resultDisplay.innerHTML = `<div class="bg-white p-20 shadow-xl print-area rounded-3xl"><div class="border-b-4 border-black pb-4 mb-8 text-center"><h1 class="text-3xl font-black uppercase">${subj || 'EXAMEN'}</h1></div><div class="whitespace-pre-wrap font-serif text-lg leading-relaxed">${res}</div><button onclick="window.print()" class="no-print w-full mt-10 bg-black text-white py-5 rounded-2xl font-bold">Imprimer le sujet</button></div>`;
        }

    </script>
</body>
</html>
